---
title: "Trend in fisheries"
author: "WGEEL"
date: "08 September 2020"
output: html_document
keep_md: yes
test: "`r paste('_metadata.yaml')`"
---
\newline
```{r setup, include=TRUE, echo=FALSE}

#--------------------------------
# get your current name 
#--------------------------------
getUsername <- function(){
	name <- Sys.info()[["user"]]
	return(name)
}
#--------------------------------

if (getUsername() == "cedric.briand") setwd("C:/workspace/gitwgeel/R/Rmarkdown") 
if (getUsername() == "cboulenger") setwd("C:/Users/cboulenger/Documents/wg_WGEEL/R/Rmarkdown") 

knitr::opts_chunk$set(echo = TRUE, warnings=FALSE)
#source("R/utilities/set_directory.R")
#data_directory <- wg_choose.dir(caption = "Where do you want to save the tables and the graphs")
#data_directory <-"C:/temp"
#knitr::opts_knit$set(root.dir = data_directory)
CY=2020
render="docx"  # html 
# temporary file to store the variables (this is necessary to print the text)

# to test the output and adapt the type of table
output <- rmarkdown::metadata$output
```



\newline
This section presents and describes data from commercial, recreational and
non-commercial fisheries, aquaculture production and restocking of eel. Data can
be reported by eel life stage (glass, yellow, silver), habitat type (freshwater,
tidal, marine) and by eel management unit (EMU) where possible. Historical
series for which these details are not available are reported by country. The
current database structure will allow aggregation by country or region if
necessary. The landings data presented are those reported to the WGEEL, either
through responses to the `r CY` Data call, in Country Reports, or integrated
by the WGEEL during data calls. 

Care should also be taken with the interpretation of the landings as indicators
of the stock, since the catch statistics now reflect the status of reduced
activity as well as of stock levels. In summary, reported commercial landings
are declining, a long-term continuing trend, from a level of around 10,000 t in
the 1960s, reported commercial landings have now dropped to xxx tonnes
(glass eel + yellow eel + silver eel) in `r CY-1`. 





 







 




```{r load_utilities, eval=TRUE, echo=FALSE,include=FALSE}

source("../utilities/load_library.R")

#-----------------
# other libraries
#-----------------
load_package("readxl")
load_package("stringr")
load_package("reshape2")
load_package("tidyr") # unite cols in maps
load_package("rlang")
load_package("sp")
#load_package("pool")
#load_package("DBI")
load_package("RPostgreSQL")
load_package("dplyr")
load_package("RColorBrewer")
load_package("sqldf")
load_package("scales")
load_package('stringr') # text handling
#load_package("XLConnect") # for excel
load_package("ggplot2") # for excel
load_package("gridExtra")
load_package("colorspace")
load_package("ggrepel")
load_package("viridis")
load_package("svglite")
load_package("leaflet.minicharts")
load_package("glue")
load_package("kableExtra")

# load functions ------------------------------------------------------------------------------------
# retrieve reference tables needed
# the shiny is launched from shiny_data_integration/shiny thus we need the ../
if(is.null(options()$sqldf.RPostgreSQL.user)) 
	source("../shiny_data_visualisation/shiny_dv/database_connection.R")
source("../shiny_data_visualisation/shiny_dv/database_reference.R")
source("../shiny_data_visualisation/shiny_dv/database_data.R")
source("../shiny_data_visualisation/shiny_dv/database_precodata.R")
source("../shiny_data_visualisation/shiny_dv/preco_diagram.R")
source("../shiny_data_visualisation/shiny_dv/graphs.R")
source("../shiny_data_visualisation/shiny_dv/maps.R")
source("../shiny_data_visualisation/shiny_dv/filter_and_group_functions.R")
source("../shiny_data_visualisation/shiny_dv/predict_missing.R")


# loading datasets 

# this file is added to the ignore list, so ask for it in your own git before launching the app
#habitat_ref <- extract_ref("Habitat type")
#lfs_code_base <- extract_ref("Life stage")
##lfs_code_base <- lfs_code_base[!lfs_code_base$lfs_code %in% c("OG","QG"),]
#country_ref <- extract_ref("Country")
#country_ref <- country_ref[order(country_ref$cou_order), ]
#country_ref$cou_code <- factor(country_ref$cou_code, levels = country_ref$cou_code[order(country_ref$cou_order)], ordered = TRUE)

##have an order for the emu
#emu_ref <- extract_ref("EMU")
#emu_cou<-merge(emu_ref,country_ref,by.x="emu_cou_code",by.y="cou_code")
#emu_cou<-emu_cou[order(emu_cou$cou_order,emu_cou$emu_nameshort),]
#emu_cou<-data.frame(emu_cou,emu_order=1:nrow(emu_cou))
## Extract data from the database -------------------------------------------------------------------
# cedric 2020 : ATTENTION LOAD shiny_di version database_interaction version uses different names
#landings = extract_data("landings",quality=c(1,2,4),quality_check=TRUE)
#aquaculture = extract_data("aquaculture",quality=c(1,2,4),quality_check=TRUE)
#release = extract_data("release",quality=c(1,2,4),quality_check=TRUE)
# this file is added to the ignore list, so ask for it in your own git before launching the app
load("../shiny_data_visualisation/shiny_dv/data/maps_for_shiny.Rdata") 
# now data are generated by the script load_data_from_the_database.R
load("../shiny_data_visualisation/shiny_dv/data/ref_and_eel_data.Rdata")
## Download the colors by country

values=c(RColorBrewer::brewer.pal(12,"Set3"),
		RColorBrewer::brewer.pal(12, "Paired"), 
		RColorBrewer::brewer.pal(8,"Accent"),
		RColorBrewer::brewer.pal(8, "Dark2"))
color_countries = setNames(values,country_ref$cou_code)



```

# Key numbers

### Glass eel landings
```{r keyNumbersLandings_G, results="asis", eval=TRUE, echo=FALSE}

landings_all<-filter_data("landings",		typ = 4)%>% dplyr::filter(is.na(eel_missvaluequal))
select_land<-aggregate(landings_all$eel_value,by=list(landings_all$eel_year,landings_all$eel_lfs_code),sum,na.rm=T)
g_CY<-round(select_land$x[select_land$Group.1==CY & select_land$Group.2=="G"]/1000,2)
g_CY1<-round(select_land$x[select_land$Group.1==CY-1 & select_land$Group.2=="G"]/1000,2)
g_mean<-mean(round(select_land$x[select_land$Group.1 %in% c((CY-6):(CY-2)) & select_land$Group.2=="G"]/1000,2))
cou_CY<-unique(landings_all$eel_cou_code[landings_all$eel_year==CY & is.na(landings_all$eel_missvaluequal) & landings_all$eel_lfs_code=="G"])
cou_CY1<-unique(landings_all$eel_cou_code[landings_all$eel_year==CY-1 & is.na(landings_all$eel_missvaluequal) & landings_all$eel_lfs_code=="G"])


knitr::asis_output(paste("Glass eel commercial fisheries within the EU in ",CY-1," = ",g_CY1," t ", "countries where data were reported: ", paste(cou_CY1,sep="", collapse=","),"<br>"))
knitr::asis_output(paste("Glass eel commercial fisheries within the EU in ",CY," = ",g_CY," t ", "countries where data were reported: ", paste(cou_CY,sep="", collapse=","),"<br>"))
knitr::asis_output(paste("Mean glass eel commercial fisheries for the previous 5 years (",CY-6,"-",CY-2,") within the EU = ",g_mean," t "))
```
\newline

### Yellow and Silver com eels landings
```{r keyNumbersLandings_YS, results="asis", eval=TRUE, echo=FALSE}

landings_YS<-filter_data("landings",		typ = 4,
		life_stage = c("Y","S","YS"))%>% dplyr::filter(is.na(eel_missvaluequal))
select_land_YS<-aggregate(landings_YS$eel_value,by=list(landings_YS$eel_year),sum,na.rm=T)
YS_CY<-round(sum(select_land_YS$x[select_land_YS$Group.1==CY-1]/1000,2))
YS_CY1<-round(select_land_YS$x[select_land_YS$Group.1==CY-2]/1000,2)
YS_mean<-mean(round(select_land_YS$x[select_land_YS$Group.1 %in% c((CY-7):(CY-3))]/1000,2))
nb_cou_CY<-length(unique(landings_YS$eel_cou_code[landings_YS$eel_year==CY-1 & is.na(landings_YS$eel_missvaluequal)]))
nb_cou_CY1<-length(unique(landings_YS$eel_cou_code[landings_YS$eel_year==CY-2 & is.na(landings_YS$eel_missvaluequal)]))


year<-unique(landings_YS$eel_year)
country<-unique(landings_YS$eel_cou_code)
hty<-unique(landings_YS$eel_hty_code)
grouped_data <-group_data(landings_YS,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)
fun.agg<-function(X){if(length(X)>0){round(sum(X)/1000,ifelse(sum(X)>1000,0,3))}else{sum(c(X,NA))}}
grouped_data$eel_cou_code = as.factor(grouped_data$eel_cou_code)                       
grouped_data <- predict_missing_values(grouped_data, verbose=FALSE, na.rm=FALSE)
select_corr_land_YS<-aggregate(grouped_data$eel_value,by=list(grouped_data$eel_year),sum,na.rm=T)
YS_corr_CY<-round(select_corr_land_YS$x[select_corr_land_YS$Group.1==CY-2]/1000,2)
YS_corr_CY1<-round(select_corr_land_YS$x[select_corr_land_YS$Group.1==CY-1]/1000,2)
YS_corr_mean<-mean(round(select_corr_land_YS$x[select_corr_land_YS$Group.1 %in% c((CY-7):(CY-3))]/1000,2))

knitr::asis_output(paste("Yellow and Silver eel commercial fisheries within the EU (Y, S, YS) in ",CY-2," = ",YS_CY1," t. ", "Number of countries reporting: ", paste(nb_cou_CY1,sep="", collapse=","),"<br>"))
knitr::asis_output(paste("Yellow and Silver eel commercial fisheries within the EU (Y, S, YS) in ",CY-1," = ",YS_CY," t. ", "Number of countries reporting: ", paste(nb_cou_CY,sep="", collapse=","),"<br>"))
knitr::asis_output(paste("Mean Yellow and Silver eel commercial fisheries for the previous 5 years (",CY-7,"-",CY-3,") within the EU = ",YS_mean," t. <br> <br>"))

knitr::asis_output(paste("Reconstructed Yellow and Silver eel commercial fisheries within the EU (Y, S, YS) in ",CY-2," = ",YS_corr_CY," t. <br>"))
knitr::asis_output(paste("Reconstructed Yellow and Silver eel commercial fisheries within the EU (Y, S, YS) in ",CY-1," = ",YS_corr_CY1," t. <br>"))
knitr::asis_output(paste("Mean Reconstructed Yellow and Silver eel commercial fisheries for the previous 5 years (",CY-7,"-",CY-3,") within the EU = ",YS_corr_mean," t.<br>"))

```


### Glass eel recreational landings

```{r keyNumbersRecLandings_G, results="asis", eval=TRUE, echo=FALSE}
landings_rec<-filter_data("landings",		typ = 6)%>% dplyr::filter(is.na(eel_missvaluequal))
select_rec<-aggregate(landings_rec$eel_value,by=list(landings_rec$eel_year,landings_rec$eel_lfs_code),sum,na.rm=T)
rec_CY<-round(select_rec$x[select_rec$Group.1==CY & select_rec$Group.2=="G"]/1000,2)
rec_CY1<-round(select_rec$x[select_rec$Group.1==CY-1 & select_rec$Group.2=="G"]/1000,2)
rec_mean<-mean(round(select_rec$x[select_rec$Group.1 %in% c((CY-6):(CY-2)) & select_rec$Group.2=="G"]/1000,2))
rec_cou_CY<-unique(landings_rec$eel_cou_code[landings_rec$eel_year==CY & is.na(landings_rec$eel_missvaluequal) & landings_rec$eel_lfs_code=="G"])
rec_cou_CY1<-unique(landings_rec$eel_cou_code[landings_rec$eel_year==CY-1 & is.na(landings_rec$eel_missvaluequal) & landings_rec$eel_lfs_code=="G"])

# mean(round(select_rec$x[select_rec$Group.1 %in% c(1978:2009) & select_rec$Group.2=="G"]/1000,2))
# mean(round(select_rec$x[select_rec$Group.1 %in% c(2010:2019) & select_rec$Group.2=="G"]/1000,2))

knitr::asis_output(paste("Glass eel recreational fisheries within the EU in ",CY-1," = ",rec_CY1," t ", "countries where data were reported: ", paste(rec_cou_CY1,sep="", collapse=","),"<br>"))
knitr::asis_output(paste("Glass eel recreational fisheries within the EU in ",CY," = ",rec_CY," t ", "countries where data were reported: ", paste(rec_cou_CY,sep="", collapse=","),"<br>"))
knitr::asis_output(paste("Mean glass eel recreational fisheries for the previous 5 years (",CY-6,"-",CY-2,") within the EU = ",rec_mean," t. <br> <br>"))

```




### Yellow and Silver eel recreational landings

```{r keyNumbersRecLandingsYS, results="asis", eval=TRUE, echo=FALSE}

landings_YS_rec<-filter_data("landings",		typ = 6,
		life_stage = c("Y","S","YS"))%>% dplyr::filter(is.na(eel_missvaluequal))
select_land_YS_rec<-aggregate(landings_YS_rec$eel_value,by=list(landings_YS_rec$eel_year),sum,na.rm=T)
YS_CY_rec<-round(sum(select_land_YS_rec$x[select_land_YS_rec$Group.1==CY-1]/1000,2))
YS_CY1_rec<-round(select_land_YS_rec$x[select_land_YS_rec$Group.1==CY-2]/1000,2)
YS_mean_rec<-mean(round(select_land_YS_rec$x[select_land_YS_rec$Group.1 %in% c((CY-7):(CY-3))]/1000,2))
nb_cou_CY_rec<-length(unique(landings_YS_rec$eel_cou_code[landings_YS_rec$eel_year==CY-1 & is.na(landings_YS_rec$eel_missvaluequal)]))
nb_cou_CY1_rec<-length(unique(landings_YS_rec$eel_cou_code[landings_YS_rec$eel_year==CY-2 & is.na(landings_YS_rec$eel_missvaluequal)]))



# landings_YS_rec<-filter_data("landings",		typ = 6,
# 		life_stage = c("G","Y","S","YS"))%>% dplyr::filter(is.na(eel_missvaluequal))
# select_land_YS_rec<-aggregate(landings_YS_rec$eel_value,by=list(landings_YS_rec$eel_year),sum,na.rm=T)
# mean(round(select_land_YS_rec$x[select_land_YS_rec$Group.1 %in% c(1978:1990)]/1000,2))
# mean(round(select_land_YS_rec$x[select_land_YS_rec$Group.1 %in% c(2009:2018)]/1000,2))
# mean(round(select_land_YS_rec$x[select_land_YS_rec$Group.1 %in% c(2019)]/1000,2))


knitr::asis_output(paste("Yellow and Silver eel recreational fisheries within the EU (Y, S, YS) in ",CY-2," = ",YS_CY1_rec," t. ", "Number of countries reporting: ", paste(nb_cou_CY1_rec,sep="", collapse=","),"<br>"))
knitr::asis_output(paste("Yellow and Silver eel recreational fisheries within the EU (Y, S, YS) in ",CY-1," = ",YS_CY_rec," t. ", "Number of countries reporting: ", paste(nb_cou_CY_rec,sep="", collapse=","),"<br>"))
knitr::asis_output(paste("Mean Yellow and Silver eel recreational fisheries for the previous 5 years (",CY-7,"-",CY-3,") within the EU = ",YS_mean_rec," t. <br> <br>"))

```

### Aquaculture

```{r keNumbersAquaculture, results="asis", eval=TRUE, echo=FALSE}
aqua<-filter_data("aquaculture", typ = 11)%>% dplyr::filter(is.na(eel_missvaluequal))
select_aqua<-aggregate(aqua$eel_value,by=list(aqua$eel_year),sum,na.rm=T)
aqua_CY<-round(select_aqua$x[select_aqua$Group.1==CY-2]/1000,2)
aqua_mean<-mean(round(select_aqua$x[select_aqua$Group.1 %in% c((CY-7):(CY-3))]/1000,2))
aqua_cou_CY<-unique(aqua$eel_cou_code[aqua$eel_year==CY-2 & is.na(aqua$eel_missvaluequal)])


knitr::asis_output(paste("Eel aquaculture within the EU in ",CY-2," = ",aqua_CY," t ", "countries where data were reported: ", paste(aqua_cou_CY,sep="", collapse=","),"<br>"))

knitr::asis_output(paste("Mean aquaculture for the previous 5 years (",CY-6,"-",CY-2,") within the EU = ",aqua_mean," t <br> <br>"))

```

### Release

```{r keyNumbersRelease, results="asis", eval=TRUE, echo=FALSE}
rel <- filter_data("release",
		typ = 9,
		life_stage = c("G","QG","Y","S"),
		year=1950:CY)%>% dplyr::filter(is.na(eel_missvaluequal))
#TODO REMOVE THIS NEXT YEAR
rel <- rel %>% dplyr::filter(!(eel_cou_code == 'SE' & eel_lfs_code=='Y'))
select_rel <- aggregate(rel$eel_value,by=list(rel$eel_year,rel$eel_lfs_code),sum,na.rm=T)
rel_CY_G <- round(sum(select_rel$x[select_rel$Group.1==CY-2 & select_rel$Group.2 %in% c("G","QG")])/10^6,2)
rel_CY_Y <- round(select_rel$x[select_rel$Group.1==CY-3 & select_rel$Group.2=="Y"]/10^6,2)
rel_CY_S <- round(select_rel$x[select_rel$Group.1==CY-1 & select_rel$Group.2=="S"]/10^6,2)

cou_CY_relG <- length(unique(rel$eel_cou_code[rel$eel_year==CY-2 & is.na(rel$eel_missvaluequal) & rel$eel_lfs_code %in% c("G","QG")]))
cou_CY_relY <- length(unique(rel$eel_cou_code[rel$eel_year==CY-3 & is.na(rel$eel_missvaluequal) & rel$eel_lfs_code=="Y"]))
cou_CY_relS <- length(unique(rel$eel_cou_code[rel$eel_year==CY-1 & is.na(rel$eel_missvaluequal) & rel$eel_lfs_code=="S"]))

knitr::asis_output(paste("Number of glass eels (G, QG) released in ",CY-2," = ",rel_CY_G, "millions , Number of countries reporting: ", paste(cou_CY_relG,sep="", collapse=","),"<br>"))
knitr::asis_output(paste("Number of yellow eels (Y) released in ",CY-3," = ",rel_CY_Y, "millions , Number of countries reporting: ", paste(cou_CY_relY,sep="", collapse=","),"<br>"))
knitr::asis_output(paste("Number of silver eels (S) released in ",CY-1," = ",rel_CY_S, "millions , Number of countries reporting: ", paste(cou_CY_relS,sep="", collapse=","),"<br><br>"))

```



# Figures
## Commercial fisheries landings 
#### Glass eel
Glass eel landings show a sharp decline since 1980 from 2 000 tonnes to around 40–60 tonnes since 2009 onwards. In 2019, the raw (uncorrected) landings data for glass eels is XXX (Annex XXX Table XXX for raw data and Table XXX for raw and corrected data). 


```{r comLandGt,echo=FALSE, warning=FALSE}

##raw commercial landings for Glass eel and every country

filtered_data <- filter_data("landings",
		typ = 4,
		life_stage = "G",
		country=c("ES","FR","IT","PT","GB")
) %>% dplyr::filter(is.na(eel_missvaluequal)) # removing data from Ireland
year <- unique(filtered_data$eel_year)
country <- unique(filtered_data$eel_cou_code)
hty <- unique(filtered_data$eel_hty_code)
grouped_data  <- group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)
fun.agg <- function(X){if(length(X)>0){round(sum(X)/1000,ifelse(sum(X)>1000,0,3))}else{sum(c(X,NA))}}

##table
table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg)
table <- data.frame(table,sum=rowSums(table[,-1],na.rm=T))



#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order  <-  n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
tableComLandG<-table
ka_com_land_G <- kable(format(table,digt=3,drop0trailing=TRUE),
		format="pandoc",caption =paste("Table 1:  Glass eel commercial fisheries landings (in tonnes) from 1984 to ",max(year),", reported by countries: GB United Kingdom, FR France, ES Spain, PT Portugal, IT Italy.", sep=""))


```



```{r com_land_Gf,echo=FALSE, warning=FALSE, fig.cap="\\label{fig:figs}Figure 1: Time-series of reported commercial glass eel fishery landings (tonnes), by country. United King-dom (GB), France (FR), Spain (ES), Portugal (PT) and Italy (IT) are included combining information from the Data call 2020 and the WGEEL database.", fig.height=5, fig.width=10}

##Graph
landings3<-grouped_data
landings3$eel_value <- as.numeric(landings3$eel_value) / 1000
landings3$eel_cou_code = as.factor(landings3$eel_cou_code)
landings3$eel_cou_code<-factor(landings3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)

GCY <-	landings3%>%filter(eel_year==CY)%>%
		group_by(eel_year)%>%
		summarize(s=sum(eel_value,na.rm=TRUE))%>%
		pull(s)

GCYm1 <- landings3%>%
		filter(eel_year==CY-1)%>%
		group_by(eel_year)%>%
		summarize(s=sum(eel_value,na.rm=TRUE))%>%
		pull(s)
#vvv$G_total_CY <- sprintf("%0.2f tons",GCY)

title <- paste("Commercial landings for glass eel in all habitats")
g_raw_Clandings_G<- ggplot(landings3) + 
		geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
		xlab("year") + 
		ylab("Landings (tonnes)")+
		#ggtitle(title)+
		scale_fill_manual("Country",values=color_countries)+
		theme_bw()
print(g_raw_Clandings_G)

```



```{r corrComG,echo=FALSE, warning=FALSE, fig.cap="\\label{fig:figs}Figure 2: Time-series of reported or reconstructed commercial glass eel fishery landings (tonnes), 1970-2020, by country. United Kingdom (GB), France (FR), Spain (ES), Portugal (PT) and Italy (IT) combining information from the Data call 2020 and the WGEEL database, and a reconstruction of the non-reported countries/years combinations (see text). The inset box shows the proportion of data reconstructed per year."}

# corrected landings
filtered_data<-filter_data("landings",
		typ = 4,
		life_stage = "G", 
		year_range = 1970:CY,
		country=c("ES","FR","IT","PT","GB"))%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)
fun.agg<-function(X){if(length(X)>0){round(sum(X)/1000,ifelse(sum(X)>1000,0,3))}else{sum(c(X,NA))}}
grouped_data$eel_cou_code = as.factor(grouped_data$eel_cou_code)                       
landings3 <- predict_missing_values(grouped_data, verbose=FALSE, na.rm=FALSE) 
landings3$eel_cou_code<-factor(landings3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
landings_year<-aggregate(eel_value~eel_year, landings3, sum)
table = dcast(landings3, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg)
table2=dcast(landings3, eel_year~eel_cou_code, value.var = "predicted",fun = prod)


#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]

#add a column with the sum of all the values and prod of predicted

table<-data.frame(table,sum=rowSums(table[,-1],na.rm = TRUE))
table2<-data.frame(table2,prod=apply(table2[,-1],1,prod,na.rm = TRUE))

#add a * when the data is predicted

for (col in 2:ncol(table)){
	table[,col][table2[,col]==0]<-paste0(table[,col][table2[,col]==0],"*")
}


# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
tableCorLandYS<-table
ka_cor_com_land_G <- kable(format(table,digt=3,drop0trailing=TRUE),format="pandoc",caption =paste("Table 12: Raw+ corr commercial landings (tonnes) for yellow and silver eels  ","(",min(year),"-",max(year),")"," for ",paste(paste(country,collapse=","), ".", sep="")))
landings3$eel_value <- landings3$eel_value/10^3
title <- paste("Corrected commercial landings for glass eel in all habitats")
g_reconstructed_landings <- ggplot(landings3) + 
		geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code),position='stack')+
		#ggtitle(title)+ 
		xlab("Year") + ylab("Landings (tonnes)")+
		coord_cartesian(expand = FALSE, ylim = c(0, max(landings_year$eel_value)*1.6/1000)) +
		scale_fill_manual("Country",values=color_countries)+
		theme_bw()

# percentage of original data
g_percentage_reconstructed <- ggplot(landings3)+
		geom_col(aes(x=eel_year,y=eel_value,fill=!predicted),position='stack')+
		xlab("") + 
		ylab("")+
		scale_fill_manual(name = "Data", values=c("black","grey"),labels=c("Predicted","Raw"))+
		theme_bw()+    
		theme(legend.position="top")


g3_grob <- ggplotGrob(g_percentage_reconstructed)
g_combined_landings_G <- g_reconstructed_landings+
		annotation_custom(g3_grob, 
				xmin=min(landings3$eel_year), 
				xmax=max(landings3$eel_year), 
				ymin=max(landings_year$eel_value)*1.05/1000, 
				ymax=max(landings_year$eel_value)*1.6/1000)
print(g_combined_landings_G)


```

#### Yellow and silver eel 

Figure 3 presents data but for yellow and silver eels aggregated coming from
20 countries, and Figure 4 presents the time-series including reconstructed
data to fill the gaps. The proportion of “corrected” landing was as high as 50%
in the 1950s, but rather low since the mid-1980s. Annex 8 Table 3 presents the
raw data for yellow and silver eel combined, Annex 8 Table 4 presents the raw
and corrected data for yellow and silver eel landings data. The total landings
of yellow and silver eels decrease from 18,000–20,000 tonnes in the 1950s to
2,000–3,000 tonnes since 2009. In XXCY-1XX, the amount was XXX
for yellow and silver landings, combined. 
```{r rawComLandYS, echo=FALSE, warning=FALSE}

##raw  com landings for Y S and YS for all the countries

filtered_data<-filter_data("landings",
		typ = 4,
		life_stage = c("Y","S","YS")
)%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##table
fun.agg<-function(X){if(length(X)>0){round(sum(X,na.rm=TRUE)/1000,ifelse(sum(X,na.rm=TRUE)>1000,0,3))}else{sum(c(X,NA))}}

table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg)
table<-data.frame(table,sum=rowSums(table[,-1],na.rm=T))              
#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
tableComLandYS<-table
table1<-table[,c(1,2:12)]
table2<-table[,c(1,13:ncol(table))]
#table3<-table[,c(1,23:ncol(table))]
ka_com_land_YS1 <- kable(format(table1,digt=3,drop0trailing=TRUE),format="pandoc",caption =paste("Table 2a:  Commercial fisheries landings (in tonnes) for yellow eel and silver eel from ", min(year)," to ",max(year)," (part 1), reported by countries: NO Norway, SE Sweden, FI Finland, EE Estonia, LV Latvia, LT Lithuania, PL Poland, DE Germany, DK Denmark,
NL Netherlands, BE Belgium (to be continued for other countries in next table).", sep=""))
ka_com_land_YS2 <- kable(format(table2,digt=3,drop0trailing=TRUE),format="pandoc",caption =paste("Table 2b:  Commercial fisheries landings (in tonnes) for yellow eel and silver eel from ", min(year)," to ",max(year)," (part 2), reported by countries and all countries: IE Ireland, GB United Kingdom, FR France, ES Spain, PT Portugal, IT Italy, Sl Sovenia, HR Croatia, GR Greece, sum .", sep=""))

```

\newline

```{r rawComLandYSf, echo=FALSE, warning=FALSE, fig.cap="\\label{fig:figs}Figure 3: Time-series of reported commercial yellow (Y), silver (S) and yellow-silver (YS) eel fishery landings (tonnes) 1908?2018, by country, Norway (NO), Sweden (SE), Finland (FI), Estonia (EE), Latvia (LV), Lithuania (LT), Poland (PL), Ger-many (DE), Denmark (DK), Netherlands (NL), Ireland (IE), United Kingdom (GB), France (FR), Spain (ES), Portugal (PT), Italy (IT), Slovenia (SI), Croatia (HR), Greece (GR), Turkey (TR) and Tunisia (TN), combining information from the Data call and the WGEEL database.", fig.height=5, fig.width=10}

## Graph
landings3<-grouped_data
landings3$eel_value <- as.numeric(landings3$eel_value) / 1000
landings3$eel_cou_code = as.factor(landings3$eel_cou_code)
landings3$eel_cou_code<-factor(landings3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
YCYm1 <- landings3%>%filter(eel_year==CY-1)%>%group_by(eel_year)%>%summarize(s=sum(eel_value,na.rm=TRUE))%>%pull(s)
#vvv$YS_total_CYm1 <- sprintf("%0.1f tons", YCYm1)
#vvv$total <- YCYm1+GCYm1

title <-  paste("Commercial landings for yellow and silver eels in all habitats")
g_raw_Clandings_YS<- ggplot(landings3) + geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
		#ggtitle(title) + 
    xlab("year") + ylab("Landings (tonnes)")+
		scale_fill_manual("Country",values=color_countries)+
		theme_bw()
print(g_raw_Clandings_YS)

```




```{r corrComYS,echo=FALSE, warning=FALSE, fig.cap="\\label{fig:figs}Figure 4: Time-series of reported or reconstructed commercial yellow and silver eel fishery landings (tonnes), by country, Norway (NO), Sweden (SE), Finland (FI), Estonia (EE), Latvia (LV), Lithuania (LT), Poland (PL), Germany (DE), Denmark (DK), Netherlands (NL), Ireland (IE), United Kingdom (GB), France (FR), Spain (ES), Portugal (PT), Italy (IT), Croatia (HR), Slovenia (SI), Greece (GR), Turkey (TR) and Tunisia (TN) combining information from the Data call, the WGEEL database and a reconstruction of the non-reported countries/years combinations. Inset box shows the proportion of reconstructed landings, per year."}

##Table raw + corr commercial landings for Yellow eel and every country



filtered_data<-filter_data("landings",
		typ = 4,
		life_stage = c("Y","S","YS") 
)%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)
fun.agg<-function(X){if(length(X)>0){round(sum(X)/1000,ifelse(sum(X)>1000,0,3))}else{sum(c(X,NA))}}
grouped_data$eel_cou_code = as.factor(grouped_data$eel_cou_code)                       
grouped_data <- predict_missing_values(grouped_data, verbose=FALSE, na.rm=FALSE) 
table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg)
table2 = dcast(grouped_data, eel_year~eel_cou_code, value.var = "predicted",fun.aggregate = prod)


#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
table2 = table2[, n_order]
#add a column with the sum of all the values and prod of predicted

table<-data.frame(table,sum=rowSums(table[,-1],na.rm = TRUE))
table2<-data.frame(table2,prod=apply(table2[,-1],1,prod,na.rm = TRUE))

#add a * when the data is predicted

for (col in 2:ncol(table)){
	table[,col][table2[,col]==0]<-paste0(table[,col][table2[,col]==1],"*")
}


# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
tableCorLandYS<-table
ka_cor_com_land_YS <- kable(format(table,digt=3,drop0trailing=TRUE),format="pandoc",caption =paste("Table 12: Raw+ corr commercial landings (tonnes) for yellow and silver eels  ","(",min(year),"-",max(year),")"," for ",paste(paste(country,collapse=","), ".", sep="")))


#landings_year <- dataset
landings3<-grouped_data
landings3$eel_cou_code<-factor(landings3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
landings_year<-aggregate(eel_value~eel_year, landings3, function(X)sum(X)/1000)
landings3$eel_value <- landings3$eel_value/1000
title <- "Reconstructed commercial landings for yellow and silver eel"
g_reconstructed_landings <- ggplot(landings3) + 
		geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code),position='stack')+
		#ggtitle(title)+ 
		xlab("Year") + ylab("Landings (tonnes)")+
		coord_cartesian(expand = FALSE, ylim = c(0, max(landings_year$eel_value)*1.6)) +
		scale_fill_manual("Country",values=color_countries)+
		theme_bw()

# percentage of original data
g_percentage_reconstructed <- ggplot(landings3)+
		geom_col(aes(x=eel_year,y=eel_value,fill=!predicted),position='stack')+
		xlab("") + 
		ylab("")+
		scale_fill_manual(name = "Data", values=c("black","grey"),labels=c("Predicted","Raw"))+
		theme_bw()+    
		theme(legend.position="top")


g3_grob <- ggplotGrob(g_percentage_reconstructed)
g_combined_landings_YS <- g_reconstructed_landings+
		annotation_custom(g3_grob, 
				xmin=min(landings3$eel_year), 
				xmax=max(landings3$eel_year), 
				ymin=max(landings_year$eel_value)*1.05, 
				ymax=max(landings_year$eel_value)*1.6)
print(g_combined_landings_YS)


```

## Recreational fisheries

```{r recLandYSt,echo=FALSE, warning=FALSE}

##Table raw rec landings for Y S and YS for all the countries


filtered_data<-filter_data("landings",
		typ = 6,
		life_stage = c("Y","S","YS"))%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)

grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##Table
fun.agg<-function(X){if(length(X)>0){round(sum(X)/1000,ifelse(sum(X)>1000,0,3))}else{sum(c(X,NA))}}

table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg)
table<-data.frame(table,sum=rowSums(table[,-1],na.rm=T))


#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
tableRecLandYS<-table
table1<-table[,c(1,2:12)]
table2<-table[,c(1,13:ncol(table))]
ka_rec_land_Y<- kable(format(table,digt=3,drop0trailing=TRUE),format="pandoc",caption =paste("Table 3: Raw recreational landings (tonnes) for yellow and silver eels  ","(",min(year),"-",max(year),")","for",paste(paste(country,collapse=","), ".", sep="")))
ka_rec_land_Y1<- kable(format(table1,digt=3,drop0trailing=TRUE),format="pandoc",caption =paste("Table 3a:  Recreational fisheries landings (in tonnes) for yellow eel and silver eel from ", min(year)," to ",max(year)," (part 1), reported by countries: NO Norway, SE Sweden, FI Finland, EE Estonia, LV Latvia, LT Lithuania, PL Poland, DE Germany, DK Denmark,NL Netherlands, BE Belgium (to be continued for other countries in next table).", sep=""))

ka_rec_land_Y2<-kable(format(table2,digt=3,drop0trailing=TRUE),format="pandoc",caption =paste("Table 3b:  Recreational fisheries landings (in tonnes) for yellow eel and silver eel from ", min(year)," to ",max(year)," (part 2), reported by countries and all countries: IE Ireland, GB United Kingdom, FR France, ES Spain, PT Portugal, IT Italy, Sl Sovenia, HR Croatia, GR Greece, sum .", sep=""))
```

\newline

```{r recLandYSf,echo=FALSE, warning=FALSE, fig.cap="\\label{fig:figs}Figure 5: Time-series of reported or reconstructed commercial yellow and silver eel fishery landings (tonnes), by country, Norway (NO), Sweden (SE), Finland (FI), Estonia (EE), Latvia (LV), Lithuania (LT), Poland (PL), Germany (DE), Denmark (DK), Netherlands (NL), Ireland (IE), United Kingdom (GB), France (FR), Spain (ES), Portugal (PT), Italy (IT), Croatia (HR), Slovenia (SI), Greece (GR), Turkey (TR) and Tunisia (TN) combining information from the Data call.", fig.height=5, fig.width=10}

##Graph
landings3<-grouped_data
landings3$eel_value <- as.numeric(landings3$eel_value) / 1000
landings3$eel_cou_code = as.factor(landings3$eel_cou_code)
landings3$eel_cou_code<-factor(landings3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
title <- paste("Recreational landings per country,", "stage = yellow and silver ", "and habitat =", paste(hty,collapse="+"))

g_raw_Rlandings_YS<- ggplot(filter(landings3,eel_value>0)) + 
		geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
		xlab("year") + ylab("Landings (tonnes)")+
		scale_fill_manual("Country",values=color_countries)+
		theme_bw()
print(g_raw_Rlandings_YS)


```

\newline

```{r recLand_G,echo=FALSE, warning=FALSE}

##Table raw rec landings for G for all the countries

filtered_data<-filter_data("landings",
		typ = 6,
		life_stage = "G")%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##Table
fun.agg<-function(X){if(length(X)>0){round(sum(X)/1000,ifelse(sum(X)>1000,0,3))}else{sum(c(X,NA))}}

table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg)
table<-data.frame(table,sum=rowSums(table[,-1],na.rm=T))


#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
tablerecLandG<-table
#table1<-table[,c(1,14,15,ncol(table))]
ka_rec_land_G <- kable(format(table,digt=3,drop0trailing=TRUE),format="pandoc",caption =paste("Table 4: Raw recreational landings (tonnes) for glass eels  ","(",min(year),"-",max(year),")"," for ",paste(paste(country,collapse=","), ".", sep="")))
#ka_rec_land_G1 <- kable(format(table1,digt=3,drop0trailing=TRUE),format="pandoc",caption =paste("Table 4:  Glass eel recreational fisheries landings (in tonnes) from ", min(year)," to ",max(year),")",", reported by countries: FR France, ES Spain.", sep=""))

```

\newline

```{r recLand_Gf,echo=FALSE, warning=FALSE, fig.cap="\\label{fig:figs}Figure 6: Time-series of reported recreational glass eel fishery landings (tonnes), by country Norway (NO), Sweden (SE), Finland (FI), Estonia (EE), Latvia (LV), Lithuania (LT), Poland (PL), Germany (DE), Netherlands (NL), Belgium (BE), Ireland (IE), United Kingdom (GB), France (FR), Spain (ES), Portugal (PT), Croatia (HR), combining information from the Data call and the WGEEL database.", fig.height=5, fig.width=10}

## Graph
landings3 <- grouped_data
landings3$eel_value <- as.numeric(landings3$eel_value) / 1000
landings3$eel_cou_code <- as.factor(landings3$eel_cou_code)
landings3$eel_cou_code <- factor(landings3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
title <- paste("Recreational landings per country,", "stage = Glass eel", "and habitat =", paste(hty,collapse="+"))
# Esti asks for contrasted colors there
g_raw_Rlandings_G <- ggplot(filter(landings3,eel_value>0)) + 
				geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
		#ggtitle(title) + 
    xlab("year") + 
		ylab("Landings (tonnes)")+
		scale_fill_brewer("Country",palette="Dark2")+
		theme_bw()
print(g_raw_Rlandings_G)

```
\newline




## Release
\newline

```{r release_Gt,echo=FALSE, warning=FALSE}

##Table release (nb) for all the countries for G # 9 is q_release_n

filtered_data<-filter_data("release",
		typ = 9,
		life_stage = c("G"),
		year=1950:CY)%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##Table
fun.agg<-function(X){if(length(X)>0){round(sum(X)/10^6,ifelse(sum(X)>10^6,0,3))}else{sum(c(X,NA))}}
table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg)
table<-data.frame(table,sum=rowSums(table[,-1],na.rm=T))


#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
tableRelG<-table
table1<-table[,c(1,2:8)]
table2<-table[,c(1,9:ncol(table))]
ka_release_G <- kable(format(table,digt=3,drop0trailing=TRUE),format="pandoc",caption =
				paste("Table 5: Release (nb in millions) of glass eels (G and OG)","(",min(year),"-",max(year),")","for",paste(paste(country,collapse=","), ".", sep="")))
ka_release_G1 <- kable(format(table1,digt=3,drop0trailing=TRUE),format="pandoc",caption =paste("Table 5a:  Release of glass eel in millions from ", min(year)," to ",max(year),")",",  reported by countries SE Sweden, EE Estonia, LV Latvia, PL Poland, DE Germany, NL Netherlands, BE Belgium(to be continued for other countries in next table).", sep=""))
ka_release_G2 <- kable(format(table2,digt=3,drop0trailing=TRUE),format="pandoc",caption =paste("Table 5b:  Release of glass eel in millions from ", min(year)," to ",max(year),")",",  reported by countries: IE Ireland, GB United Kingdom, FR France, ES Spain, IT Italy, GR Greece.", sep=""))

```

\newline

```{r release_Gf,echo=FALSE, warning=FALSE, fig.cap="\\label{fig:figs}Figure 7: Reported released of glass eel and ongrown glass eel (in millions) per country, Sweden (SE), Estonia (EE), Latvia (LV), Poland (PL), Germany (DE), Netherlands (NL), Belgium (BE), Ireland (IE), United Kingdom (GB), France (FR), Spain (ES), Italy (IT) and Greece (GR).", fig.height=5, fig.width=10}

##Graph
release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value)/10^6 
release3$eel_cou_code = as.factor(release3$eel_cou_code)
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
title <- paste("Released per country,", "stage = G and OG", "and habitat =", paste(hty,collapse="+"))

g_release_G <-  ggplot(release3) + 
		geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
		#ggtitle(title) + 
    xlab("year") + ylab("Release (n) in millions")+
		scale_fill_manual("Country",values=color_countries)+
		theme_bw() 

print(g_release_G)

```


```{r releasekg_Gf,echo=FALSE, warning=FALSE, fig.cap="\\label{fig:figs}Figure X: Reported released of glass eel (in tonnes) per country Estonia (EE), Latvia (LV), Poland (PL), Germany (DE), Netherlands (NL), Belgium (BE), Ireland (IE), United Kingdom (GB), France (FR), Spain (ES), Italy (IT) and Greece (GR).", fig.height=5, fig.width=10}

##Table release (nb) for all the countries for G # 9 is q_release_kg

filtered_data<-filter_data("release",
		typ = 8,
		life_stage = c("G"),
		year=1950:CY)%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)
##Graph
release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value)/1000 
release3$eel_cou_code = as.factor(release3$eel_cou_code)
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
title <- paste("Released per country,", "stage = G and OG", "and habitat =", paste(hty,collapse="+"))

g_releasekg_G <-  ggplot(release3) + 
		geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
		#ggtitle(title) + 
    xlab("year") + ylab("Release in tonnes")+
		scale_fill_manual("Country",values=color_countries)+
		theme_bw() 

print(g_releasekg_G)
```

\newline

```{r release_Yt,echo=FALSE, warning=FALSE}

##Table release (nb) for all the countries for Y

filtered_data<-filter_data("release",
		typ = 9,
		life_stage = c("OG","Y"))%>% dplyr::filter(is.na(eel_missvaluequal))
#TODO REMOVE THIS NEXT YEAR
filtered_data <- filtered_data %>% dplyr::filter(!(eel_cou_code == 'SE'))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)
fun.agg<-function(X){if(length(X)>0){round(sum(X)/10^6,ifelse(sum(X)>10^6,0,3))}else{sum(c(X,NA))}}
table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg)
table<-data.frame(table,sum=rowSums(table[,-1],na.rm=T))


#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
tableRelY<-table
ka_release_Y <- kable(format(table,digt=3,drop0trailing=TRUE),format="pandoc",caption =paste("Table 6:  Releases for yellow eel from ", min(year)," to ",max(year)," in millions, reported by countries DE Germany, NL Netherlands, IE Ireland, ES Spain, IT Italy.", sep=""))

```

\newline


```{r release_Yf,echo=FALSE, warning=FALSE, fig.cap="\\label{fig:figs}Figure 8:Reported released of yellow eel (in millions; OG and Y) per country, Germany (DE), Netherlands (NL),  Ireland (IE), Spain (ES) and Italy (IT).", fig.height=5, fig.width=10}
##Graph

release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value) / 10^6
release3$eel_cou_code = as.factor(release3$eel_cou_code)
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
title <- paste("Released per country,", "stage = Y", "and habitat =", paste(hty,collapse="+"))

g_release_Y <-  ggplot(release3) + 
		geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
		#ggtitle(title) + 
    xlab("year") + ylab("Release (n) in million")+
		scale_fill_manual("Country",values=color_countries)+
		theme_bw() 

print(g_release_Y)
```


```{r releasekg_Yf,echo=FALSE, warning=FALSE, fig.cap="\\label{fig:figs}Figure x:Reported released of yellow eel (in tonnes) per country: Sweden (SE) Germany (DE), Netherlands (NL),  Ireland (IE), Spain (ES) and Italy (IT).", fig.height=5, fig.width=10}

filtered_data<-filter_data("release",
		typ = 8,
		life_stage = c("Y"))%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##Graph

release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value) / 1000
release3$eel_cou_code = as.factor(release3$eel_cou_code)
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
title <- paste("Released per country,", "stage = Y", "and habitat =", paste(hty,collapse="+"))

g_releasekg_Y <-  ggplot(release3) + 
		geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
		#ggtitle(title) + 
    xlab("year") + ylab("Release in tonnes")+
		scale_fill_manual("Country",values=color_countries)+
		theme_bw() 

print(g_releasekg_Y)
```

\newline

```{r release_St,echo=FALSE, warning=FALSE}

##Table release (nb) for all the countries and S

filtered_data<-filter_data("release",
		typ = 9,
		life_stage = "S")%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)
fun.agg<-function(X){if(length(X)>0){round(sum(X)/10^6,ifelse(sum(X)>10^6,0,3))}else{sum(c(X,NA))}}
table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg)
table<-data.frame(table,sum=rowSums(table[,-1],na.rm=T))


#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
tableRelS<-table
ka_release_S <- kable(format(table,digt=3,drop0trailing=TRUE),format="pandoc",caption =paste("Table 7: Releases for silver eel from ", min(year)," to ",max(year)," in millions, reported by countries SE Sweden, FI Finland, IE Ireland, Fr France, ES Spain, GR Greece.", sep=""))

```

\newline




```{r release_Sf,echo=FALSE, warning=FALSE, fig.cap="\\label{fig:figs}Figure 9: Reported released of silver eel (in thousands) per country, Sweden (SE), Finland (FI), Ireland (IE), France (FR), Spain (ES), and Greece (GR).", fig.height=5, fig.width=10}

##Graph
release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value) / 1000
release3$eel_cou_code = as.factor(release3$eel_cou_code)
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
title <- paste("Released per country,", "stage = S", "and habitat =", paste(hty,collapse="+"))

g_release_S <-  ggplot(release3) + 
		geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
		#ggtitle(title) + 
    xlab("year") + ylab("1000 * Release (n)")+
		scale_fill_manual("Country",values=color_countries)+
		theme_bw() 

print(g_release_S)
```



```{r releasekg_Sf,echo=FALSE, warning=FALSE, fig.cap="\\label{fig:figs}Figure x: Reported released of silver eel (in tonnes) per country, Sweden (SE), Finland (FI), Ireland (IE), France (FR), Spain (ES), and Greece (GR).", fig.height=5, fig.width=10}

filtered_data<-filter_data("release",
		typ = 8,
		life_stage = "S")%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##Graph
release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value) / 1000
release3$eel_cou_code = as.factor(release3$eel_cou_code)
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
title <- paste("Released per country,", "stage = S", "and habitat =", paste(hty,collapse="+"))

g_releasekg_S <-  ggplot(release3) + 
		geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
		#ggtitle(title) + 
    xlab("year") + ylab("Release in tonnes")+
		scale_fill_manual("Country",values=color_countries)+
		theme_bw() 

print(g_releasekg_S)
```

\newline

```{r release_QGt,echo=FALSE, warning=FALSE}

##Table release (nb) for all the countries for QG


filtered_data<-filter_data("release",
		typ = 9,
		life_stage = "QG")%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)
fun.agg<-function(X){if(length(X)>0){round(sum(X)/10^6,ifelse(sum(X)>10^6,0,3))}else{sum(c(X,NA))}}
table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg)
table<-data.frame(table,sum=rowSums(table[,-1],na.rm=T))


#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
tableRelQG<-table
ka_release_QG <- kable(format(table,digt=3,drop0trailing=TRUE),format="pandoc",caption =paste("Table 8: Releases for quarantined glass eel from ", min(year)," to ",max(year)," in millions, reported by countries SE Sweden, FI Finland.", sep=""))

```

\newline



```{r release_QGf,echo=FALSE, warning=FALSE,  fig.cap="\\label{fig:figs}Figure 10: Reported released of Quarantined glass eel (in thousands) per country, Sweden (SE) and Finland (FI).", fig.height=5, fig.width=10}

##Graph
release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value) / 1000
release3$eel_cou_code = as.factor(release3$eel_cou_code)
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
title <- paste("Released per country,", "stage = QG", "and habitat =", paste(hty,collapse="+"))

g_release_QG <-  ggplot(release3) + 
		geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
		#ggtitle(title) + 
    xlab("year") + ylab("1000 * Release (n)")+
		scale_fill_manual("Country",values=color_countries)+
		theme_bw() 

print(g_release_QG)

```


```{r releasekg_QGf,echo=FALSE, warning=FALSE,fig.cap="\\label{fig:figs}Figure x: Reported released of Quarantined glass eel (in tonnes) per country, Sweden (SE) and Finland (FI).", fig.height=5, fig.width=10}

filtered_data<-filter_data("release",
		typ = 8,
		life_stage = "QG")%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##Graph
release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value) / 1000
release3$eel_cou_code = as.factor(release3$eel_cou_code)
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
title <- paste("Released per country,", "stage = QG", "and habitat =", paste(hty,collapse="+"))

g_releasekg_QG <-  ggplot(release3) + 
		geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
		#ggtitle(title) + 
    xlab("year") + ylab("Release (tonnes)")+
		scale_fill_manual("Country",values=color_countries)+
		theme_bw() 

print(g_releasekg_QG)

```

\newline

```{r release_OGt,echo=FALSE, warning=FALSE}

##Table release (nb) for all the countries

filtered_data<-filter_data("release",
		typ = 9,
		life_stage = "OG" 
)%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)
fun.agg<-function(X){if(length(X)>0){round(sum(X)/10^6,ifelse(sum(X)>10^6,0,3))}else{sum(c(X,NA))}}
table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg)
table<-data.frame(table,sum=rowSums(table[,-1],na.rm=T))


#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
tableRelOG<-table
ka_release_OG <- kable(format(table,digt=3,drop0trailing=TRUE),format="pandoc",caption =paste("Table 9: Releases for ongrown glass eel from ", min(year)," to ",max(year)," in millions, reported by countries: EE Estonia, LV Latvia, LT Lithuania, PL Poland, DE Germany, DK Denmark, ES Spain.", sep=""))

```

\newline

```{r release_OGf,echo=FALSE, warning=FALSE, fig.cap="\\label{fig:figs}Figure 11: Reported released of ongrown glass eel (in thousands) per country, Estonia (EE), Latvia (LV), Lithuania (LT), Poland (PL), Germany (DE), Denmark (DK) and Spain (ES).", fig.height=5, fig.width=10}


release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value) / 1000
release3$eel_cou_code = as.factor(release3$eel_cou_code)
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
title <- paste("Released per country,", "stage = OG", "and habitat =", paste(hty,collapse="+"))

g_release_OG <-  ggplot(release3) + 
		geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
		#ggtitle(title) + 
    xlab("year") + ylab("1000 * Release (n)")+
		scale_fill_manual("Country",values=color_countries)+
		theme_bw() 

print(g_release_OG)

```


```{r releasekg_OGf,echo=FALSE, warning=FALSE, fig.cap="\\label{fig:figs}Figure x: Reported released of ongrown glass eel (in tonnes) per country, Estonia (EE), Latvia (LV), Lithuania (LT), Poland (PL), Germany (DE), Denmark (DK) and Spain (ES).", fig.height=5, fig.width=10}

filtered_data<-filter_data("release",
		typ = 8,
		life_stage = "OG" 
)%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)
##Graph
##Graph
release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value) / 1000
release3$eel_cou_code = as.factor(release3$eel_cou_code)
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
title <- paste("Released per country,", "stage = OG", "and habitat =", paste(hty,collapse="+"))

g_releasekg_OG <-  ggplot(release3) + 
		geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
		#ggtitle(title) + 
    xlab("year") + ylab("Release (tonnes)")+
		scale_fill_manual("Country",values=color_countries)+
		theme_bw() 

print(g_releasekg_OG)



```



\newline


```{r release_all_stages,echo=FALSE, warning=FALSE, fig.cap="\\label{fig:figs}Figure 12: Reported released of all stages (Y, YS, OG, S, QG) (in millions) per country, Sweden (SE), Finland (FI), Estonia (EE), Latvia (LV), Lithuania (LT), Poland (PL), Germany (DE), Denmark (DK), Netherlands (NL), Belgium (BE), Ireland (IE), United Kingdom (GB), France (FR), Spain (ES), Italy (IT) and Greece (GR)..", fig.height=5, fig.width=10}

##Table release of all stages for all the countries

filtered_data<-filter_data("release",
		typ = 9,
		life_stage=c("G","Y","QG","OG","YS","S"),
		year_range = 1950:max(year))%>% dplyr::filter(is.na(eel_missvaluequal))
#TODO REMOVE THIS NEXT YEAR
filtered_data <- filtered_data %>% dplyr::filter(!(eel_cou_code == 'SE' & eel_lfs_code=='Y'))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
lfs<-unique(filtered_data$eel_lfs_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##Graph
release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value) / 10^6
release3$eel_cou_code = as.factor(release3$eel_cou_code)
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
title <- paste("Released per country,", "habitat =", paste(hty,collapse="+"), "and", "stage =", paste(lfs,collapse="+"))

g_release_all <-  ggplot(release3) + 
		geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
		#ggtitle(title) + 
    xlab("year") + ylab("Release (n) in millions")+
		scale_fill_manual("Country",values=color_countries)+
		theme_bw() 

print(g_release_all)
```


```{r releasekg_all_stages,echo=FALSE, warning=FALSE, fig.cap="\\label{fig:figs}Figure 12: Reported released of all stages (Y, YS, OG, S, QG) (in tonnes) per country, Sweden (SE), Finland (FI), Estonia (EE), Latvia (LV), Lithuania (LT), Poland (PL), Germany (DE), Denmark (DK), Netherlands (NL), Belgium (BE), Ireland (IE), United Kingdom (GB), France (FR), Spain (ES), Italy (IT) and Greece (GR)..", fig.height=5, fig.width=10}

##Table release of all stages for all the countries

filtered_data<-filter_data("release",
		typ = 8,
		life_stage=c("G","Y","QG","OG","YS","S"),
		year_range = 1950:max(year))%>% dplyr::filter(is.na(eel_missvaluequal))
#TODO REMOVE THIS NEXT YEAR
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
lfs<-unique(filtered_data$eel_lfs_code)
grouped_data <-group_data(filtered_data,geo="country",habitat=FALSE,lfs=FALSE,na.rm=TRUE)

##Graph
release3<-grouped_data
release3$eel_value <- as.numeric(release3$eel_value) / 1000
release3$eel_cou_code = as.factor(release3$eel_cou_code)
release3$eel_cou_code<-factor(release3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
title <- paste("Released per country,", "habitat =", paste(hty,collapse="+"), "and", "stage =", paste(lfs,collapse="+"))

g_releasekg_all <-  ggplot(release3) + 
		geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
		#ggtitle(title) + 
    xlab("year") + ylab("Release in tonnes")+
		scale_fill_manual("Country",values=color_countries)+
		theme_bw() 

print(g_releasekg_all)
```

## Aquaculture


\newline


```{r aquat,echo=FALSE, warning=FALSE}

##Table aquaculture for all the countries

filtered_data<-filter_data("aquaculture",
		typ = 11)%>% dplyr::filter(is.na(eel_missvaluequal))
year<-unique(filtered_data$eel_year)
country<-unique(filtered_data$eel_cou_code)
hty<-unique(filtered_data$eel_hty_code)
grouped_data <-group_data(filtered_data, geo="country", habitat=FALSE, lfs=FALSE, na.rm=TRUE)

##Table
fun.agg<-function(X){if(length(X)>0){round(sum(X)/1000,ifelse(sum(X)>1000,0,3))}else{sum(c(X,NA))}}

table = dcast(grouped_data, eel_year~eel_cou_code, value.var = "eel_value",fun.aggregate = fun.agg)
table<-data.frame(table,sum=rowSums(table[,-1],na.rm=T))


#ordering the column accordign to country order
country_to_order = names(table)[-1]
n_order = order(country_ref$cou_order[match(country_to_order, country_ref$cou_code)])
n_order <- n_order+1
n_order <- c(1,n_order)
table = table[, n_order]
# options(knitr.kable.NA="") this does not work
names(table)[1]<-"Year"
table[is.na(table)]<-''
tableAqua<-table
table1<-table[,c(1,2:8)]
table2<-table[,c(1,9:ncol(table))]
ka_aqua <- kable(format(table,digt=3,drop0trailing=TRUE),format="pandoc",caption =paste("Table 10: Aquaculture for all stages in tonnes from ",min(year)," to ",max(year)," reported by countries: SE Sweden, FI Finland, EE Estonia, LT Lithuania, PL Poland, DE Germany, DK Denmark, NL Netherlands, IE Ireland, ES Spain, PT Portugal, IT Italy, GR Greece.", sep=""))
ka_aqua1 <- kable(format(table1,digt=3,drop0trailing=TRUE),format="pandoc",caption =paste("Table 10a: Aquaculture for all stages in tonnes from ",min(year)," to ",max(year)," reported by countries: SE Sweden, FI Finland, EE Estonia, LT Lithuania, PL Poland, DE Germany, DK Denmark.(to be continued for other countries in next table)", sep=""))
ka_aqua2 <- kable(format(table2,digt=3,drop0trailing=TRUE),format="pandoc",caption =paste("Table 10b: Aquaculture for all stages in tonnes from ",min(year)," to ",max(year)," reported by countries: NL Netherlands, IE Ireland, ES Spain, PT Portugal, IT Italy, GR Greece.", sep=""))

```

\newline

```{r aquaf,echo=FALSE, warning=FALSE, fig.cap="\\label{fig:figs}Figure 13: Reported aquaculture production of European eel in Europe from 1984 onwards, in tonnes, in Sweden (SE), Finland (FI), Estonia (EE), Lithuania (LT), Poland (PL), Germany (DE), Denmark (DK), Netherlands (NL), Ireland (IE), Spain (ES), Portugal (PT), Italy (IT) and Greece (GR).", fig.height=5, fig.width=10}

## Graph
aquaculture3<-grouped_data
aquaculture3$eel_value <- as.numeric(aquaculture3$eel_value) / 1000
aquaculture3$eel_cou_code = as.factor(aquaculture3$eel_cou_code)
aquaculture3$eel_cou_code<-factor(aquaculture3$eel_cou_code,levels=country_ref$cou_code,ordered=TRUE)
title <- paste("Aquaculture per country,","all stages and all habitats")

g_aquaculture <-  ggplot(aquaculture3) + 
		geom_col(aes(x=eel_year,y=eel_value,fill=eel_cou_code), position='stack')+
		#ggtitle(title) + 
    xlab("year") + ylab("Aquaculture (tonnes)")+
		scale_fill_manual("Country",values=color_countries)+
		theme_bw()  
print(g_aquaculture)

```


\newline


# tables

```{r table, echo=FALSE, warning=FALSE, results="asis"}

print(ka_com_land_G)
print(ka_com_land_YS1)
print(ka_com_land_YS2)
print(ka_rec_land_Y1)
print(ka_rec_land_Y2)
print(ka_rec_land_G)
print(ka_release_G1)
print(ka_release_G2)
print(ka_release_Y)
print(ka_release_S)
print(ka_release_QG)
print(ka_release_OG)
print(ka_aqua1)
print(ka_aqua2)

```


```{r save_graphs_and_tables,echo=FALSE, warning=FALSE}

#data_directory <- wg_choose.dir(caption = "Where do you want to save the tables and the graphs")
#setwd(data_directory)
#save(vvv,file="vvv.Rdata")
write.csv2(tableComLandG,"Raw_Com_landings_G.csv",row.names=FALSE)
#write.csv2(tableComLandYS,"Raw_Com_landings_Y_S.csv",row.names=FALSE)
write.csv2(tableRecLandYS,"Raw_Rec_landings_Y_S.csv",row.names=FALSE)
write.csv2(tablerecLandG,"Raw_Rec_landings_G.csv",row.names=FALSE)
write.csv2(tableAqua,"Aquaculture_tons.csv",row.names=FALSE)
write.csv2(tableRelG,"releases_nb_G.csv",row.names=FALSE)
write.csv2(tableRelS,"releases_nb_S.csv",row.names=FALSE)
write.csv2(tableRelY,"releases_nb_Y.csv",row.names=FALSE)
write.csv2(tableRelQG,"releases_nb_QG.csv",row.names=FALSE)
write.csv2(tableRelOG,"releases_nb_OG.csv",row.names=FALSE)
write.csv2(tableCorLandYS,"Raw_Corr_Com_landings_Y_S.csv",row.names=FALSE)

ggsave("Raw_Com_landings_G.png", g_raw_Clandings_G, device = "png", width = 30, height = 20, 
		units = "cm")
ggsave("Raw_Com_landings_YS.png", g_raw_Clandings_YS, device = "png", width = 30, height = 20, 
		units = "cm")
ggsave("Raw_Rec_landings_G.png", g_raw_Rlandings_G, device = "png", width = 30, height = 20,  
		units = "cm")
ggsave("Raw_Rec_landings_YS.png", g_raw_Rlandings_YS, device = "png", width = 30, height = 20,  
		units = "cm")
ggsave("Aquaculture.png", g_aquaculture, device = "png", width = 30, height = 20,
		units = "cm")

ggsave("Releases_G.png", g_release_G, device = "png", width = 30, height = 20,  
		units = "cm")
ggsave("Releases_Y.png", g_release_Y, device = "png", width = 30, height = 20,  
		units = "cm")
ggsave("Releases_S.png", g_release_S, device = "png", width = 30, height = 20,  
		units = "cm")
ggsave("Releases_QG.png", g_release_QG, device = "png", width = 30, height = 20, 
		units = "cm")
ggsave("Releases_OG.png", g_release_OG, device = "png", width = 30, height = 20, 
		units = "cm")
ggsave("Releases_all.png",g_release_all, device = "png", width = 30, height = 20, 
		units = "cm")
ggsave("Raw_Corr_com_landings_YS.png", g_combined_landings_YS, device = "png", width = 30, height = 20, 
		units = "cm")
ggsave("Raw_Corr_com_landings_G.png", g_combined_landings_G, device = "png", width = 30, height = 20, 
		units = "cm")

```
